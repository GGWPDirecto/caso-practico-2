---
# Tareas para el rol de ACR
- name: Login en ACR
  community.docker.docker_login:
    registry_url: "{{ acr_login_server }}"
    username: "{{ acr_username }}"
    password: "{{ acr_password }}"
  delegate_to: localhost

- name: Descargar imagen desde DockerHub
  community.docker.docker_image:
    name: "{{ dockerhub_image }}"
    source: pull
    force_source: true
  delegate_to: localhost

- name: Etiquetar manualmente la imagen como casopractico2
  ansible.builtin.command: >
    docker tag {{ dockerhub_image }} {{ acr_login_server }}/{{ acr_image_name }}:casopractico2
  delegate_to: localhost
  ignore_errors: true

- name: Subir imagen a ACR (casopractico2)
  community.docker.docker_image:
    name: "{{ acr_login_server }}/{{ acr_image_name }}"
    tag: casopractico2
    source: local
    push: true
  delegate_to: localhost
